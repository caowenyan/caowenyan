## 简单动态字符串

### 使用场景：
1. 保存数据库的字符串值
2. 用作缓冲区（AOF模块中的AOF缓冲区，客户端状态的输入缓冲区）

### 定义：
SDS(Simple Dynamic String，简单动态字符串)
```
struct sdshdr {
    // 已使用的字符，不包含最后的空字符'\0'
    int len;
    // 未使用的字符
    int free;
    // 字节数组，用于保存字符串
    char buf[];
}
```

### SDS和C字符串的区别
1. 常数复杂度获取字符串长度
2. 避免缓冲区溢出（a.strcat(b)，若是没有给a扩容，且a没有足够的内存存储b，则会导致内存溢出，将a之后的空间覆盖）
3. 减少修改字符串时带来的内存重分配的次数（增加或缩短一个字符串时，需要程序对字符串进行一次内存重分配操作，若是忘记可能导致内存溢出或者内存泄露）
    + 扩展SDS空间之前，若空间足够（增加的字符串长度小于free），则可以直接拼接对象，若是大于free，空间不足，则执行空间预分配策略，使得增加N次字符串分配最多N次。
        + **空间预分配**：通过优化SDS的字符串增长操作，程序不仅会为SDS分配修改所必需的空间，还会为SDS**分配额外的未使用的空间**  
        ```
                        /修改后len < 1m，则free = len  
        - 额外配置的公式：  
                        \修改后len >= 1m，则free = 1m 
        ``` 
    + 缩短字符串时，并不立即使用内存重分配来缩短多出来的字节，而是使用free把这些字节的数量记录起来**惰性空间释放**。（所以清空SDS保存的内容的时间复杂度是O(1)，也可以调用api真正释放SDS的空间）
4. 二进制安全，既可以保存文本又可以保存二进制数据
5. 兼容部分C字符串函数（字符串末尾总有空字符）